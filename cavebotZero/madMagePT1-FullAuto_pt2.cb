{
    "arrowKeysDelay": 0,
    "autoRecorder": 3,
    "disablePlayerWalkthrough": false,
    "dynamicLure": true,
    "enableEndLureDontLeaveIfCreatureHpLessThan": false,
    "enableMinCreatureHpCheckLureLeave": false,
    "endLureDontLeaveIfCreatureHpLessThan": 0,
    "endLureDontLeaveIfCreatureHpLessThanCount": 0,
    "endLureTryWalkToCenter": false,
    "forceWalkBlockableTilesAround": 4,
    "ignoreLureList": [
    ],
    "ignoreNonReachableCreatures": false,
    "isMapClick": false,
    "maxLureLeave": 0,
    "minCreatureHpCheckLureLeave": 0,
    "minCreatureHpCheckLureLeaveCount": 0,
    "minLureStop": 99,
    "minLureWalk": 99,
    "nearLureCreatureDistance": 5,
    "nearLureCreaturesCount": 30,
    "nodeDistance": 2,
    "specialAreas": [
    ],
    "specialAreasExtendIfDrunk": false,
    "startNearestWaypoint": true,
    "waypoints": [
     {"data": "","waypointType": 1,"x": 33312,"y": 487,"z": 31848},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33312,"y": 487,"z": 31848},
{"data": "","waypointType": 1,"x": 33312,"y": 488,"z": 31851},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33312,"y": 488,"z": 31851},
{"data": "","waypointType": 1,"x": 33312,"y": 489,"z": 31854},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33312,"y": 489,"z": 31854},
{"data": "","waypointType": 1,"x": 33312,"y": 490,"z": 31858},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33312,"y": 490,"z": 31858},
{"data": "","waypointType": 1,"x": 33313,"y": 491,"z": 31861},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33313,"y": 491,"z": 31861},
{"data": "","waypointType": 1,"x": 33314,"y": 492,"z": 31865},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33314,"y": 492,"z": 31865},
{"data": "","waypointType": 1,"x": 33316,"y": 493,"z": 31869},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33316,"y": 493,"z": 31869},
{"data": "","waypointType": 1,"x": 33317,"y": 494,"z": 31872},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33317,"y": 494,"z": 31872},
{"data": "","waypointType": 1,"x": 33320,"y": 495,"z": 31872},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33320,"y": 495,"z": 31872},
{"data": "","waypointType": 1,"x": 33322,"y": 496,"z": 31873},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33322,"y": 496,"z": 31873},
{"data": "","waypointType": 1,"x": 33325,"y": 497,"z": 31873},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33325,"y": 497,"z": 31873},
{"data": "","waypointType": 1,"x": 33327,"y": 498,"z": 31873},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33327,"y": 498,"z": 31873},
{"data": "","waypointType": 1,"x": 33329,"y": 499,"z": 31873},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33329,"y": 499,"z": 31873},
{"data": "","waypointType": 1,"x": 33331,"y": 500,"z": 31873},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33331,"y": 500,"z": 31873},
{"data": "","waypointType": 1,"x": 33333,"y": 501,"z": 31874},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33333,"y": 501,"z": 31874},
{"data": "","waypointType": 1,"x": 33335,"y": 502,"z": 31876},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 502,"z": 31876},
{"data": "","waypointType": 1,"x": 33337,"y": 503,"z": 31878},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33337,"y": 503,"z": 31878},
{"data": "","waypointType": 1,"x": 33339,"y": 504,"z": 31879},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33339,"y": 504,"z": 31879},
{"data": "","waypointType": 1,"x": 33341,"y": 505,"z": 31880},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33341,"y": 505,"z": 31880},
{"data": "","waypointType": 1,"x": 33342,"y": 506,"z": 31880},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33342,"y": 506,"z": 31880},
{"data": "","waypointType": 1,"x": 33343,"y": 507,"z": 31881},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33343,"y": 507,"z": 31881},
{"data": "","waypointType": 1,"x": 33345,"y": 508,"z": 31881},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33345,"y": 508,"z": 31881},
{"data": "","waypointType": 1,"x": 33345,"y": 509,"z": 31882},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33345,"y": 509,"z": 31882},
{"data": "","waypointType": 1,"x": 33346,"y": 510,"z": 31882},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33346,"y": 510,"z": 31882},
{"data": "","waypointType": 1,"x": 33347,"y": 511,"z": 31883},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33347,"y": 511,"z": 31883},
{"data": "","waypointType": 1,"x": 33349,"y": 512,"z": 31884},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33349,"y": 512,"z": 31884},
{"data": "","waypointType": 1,"x": 33348,"y": 513,"z": 31885},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33348,"y": 513,"z": 31885},
{"data": "","waypointType": 1,"x": 33348,"y": 514,"z": 31887},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33348,"y": 514,"z": 31887},
{"data": "","waypointType": 1,"x": 33348,"y": 515,"z": 31890},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33348,"y": 515,"z": 31890},
{"data": "","waypointType": 1,"x": 33348,"y": 516,"z": 31893},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33348,"y": 516,"z": 31893},
{"data": "","waypointType": 1,"x": 33348,"y": 517,"z": 31894},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33348,"y": 517,"z": 31894},
{"data": "","waypointType": 1,"x": 33348,"y": 518,"z": 31897},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33348,"y": 518,"z": 31897},
{"data": "","waypointType": 1,"x": 33348,"y": 519,"z": 31898},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33348,"y": 519,"z": 31898},
{"data": "","waypointType": 1,"x": 33347,"y": 520,"z": 31898},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33347,"y": 520,"z": 31898},
{"data": "","waypointType": 1,"x": 33347,"y": 521,"z": 31900},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33347,"y": 521,"z": 31900},
{"data": "","waypointType": 1,"x": 33343,"y": 522,"z": 31900},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33343,"y": 522,"z": 31900},
{"data": "","waypointType": 1,"x": 33340,"y": 523,"z": 31900},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33340,"y": 523,"z": 31900},
{"data": "","waypointType": 1,"x": 33338,"y": 524,"z": 31902},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33338,"y": 524,"z": 31902},
{"data": "","waypointType": 1,"x": 33336,"y": 525,"z": 31904},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33336,"y": 525,"z": 31904},
{"data": "","waypointType": 1,"x": 33335,"y": 526,"z": 31905},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 526,"z": 31905},
{"data": "","waypointType": 1,"x": 33335,"y": 527,"z": 31907},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 527,"z": 31907},
{"data": "","waypointType": 1,"x": 33335,"y": 528,"z": 31908},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 528,"z": 31908},
{"data": "","waypointType": 1,"x": 33335,"y": 529,"z": 31909},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 529,"z": 31909},
{"data": "","waypointType": 1,"x": 33335,"y": 530,"z": 31910},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 530,"z": 31910},
{"data": "","waypointType": 1,"x": 33335,"y": 531,"z": 31912},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 531,"z": 31912},
{"data": "","waypointType": 1,"x": 33335,"y": 532,"z": 31913},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 532,"z": 31913},
{"data": "","waypointType": 1,"x": 33337,"y": 533,"z": 31913},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33337,"y": 533,"z": 31913},
{"data": "","waypointType": 1,"x": 33338,"y": 534,"z": 31913},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33338,"y": 534,"z": 31913},
{"data": "","waypointType": 1,"x": 33339,"y": 535,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33339,"y": 535,"z": 31914},
{"data": "","waypointType": 1,"x": 33340,"y": 536,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33340,"y": 536,"z": 31914},
{"data": "","waypointType": 1,"x": 33341,"y": 537,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33341,"y": 537,"z": 31914},
{"data": "","waypointType": 1,"x": 33342,"y": 538,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33342,"y": 538,"z": 31914},
{"data": "","waypointType": 1,"x": 33343,"y": 539,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33343,"y": 539,"z": 31914},
{"data": "","waypointType": 1,"x": 33343,"y": 540,"z": 31913},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33343,"y": 540,"z": 31913},
{"data": "","waypointType": 1,"x": 33344,"y": 541,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33344,"y": 541,"z": 31914},
{"data": "","waypointType": 1,"x": 33345,"y": 542,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33345,"y": 542,"z": 31915},
{"data": "","waypointType": 1,"x": 33344,"y": 543,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33344,"y": 543,"z": 31915},
{"data": "","waypointType": 1,"x": 33342,"y": 544,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33342,"y": 544,"z": 31915},
{"data": "","waypointType": 1,"x": 33341,"y": 545,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33341,"y": 545,"z": 31915},
{"data": "","waypointType": 1,"x": 33340,"y": 546,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33340,"y": 546,"z": 31915},
{"data": "","waypointType": 1,"x": 33339,"y": 547,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33339,"y": 547,"z": 31915},
{"data": "","waypointType": 1,"x": 33338,"y": 548,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33338,"y": 548,"z": 31915},
{"data": "","waypointType": 1,"x": 33338,"y": 549,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33338,"y": 549,"z": 31914},
{"data": "","waypointType": 1,"x": 33337,"y": 550,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33337,"y": 550,"z": 31914},
{"data": "","waypointType": 1,"x": 33336,"y": 551,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33336,"y": 551,"z": 31914},
{"data": "","waypointType": 1,"x": 33336,"y": 552,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33336,"y": 552,"z": 31915},
{"data": "","waypointType": 1,"x": 33335,"y": 553,"z": 31916},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 553,"z": 31916},
{"data": "","waypointType": 1,"x": 33335,"y": 554,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 554,"z": 31914},
{"data": "","waypointType": 1,"x": 33335,"y": 555,"z": 31911},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 555,"z": 31911},
{"data": "","waypointType": 1,"x": 33335,"y": 556,"z": 31906},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33335,"y": 556,"z": 31906},
{"data": "","waypointType": 1,"x": 33338,"y": 557,"z": 31903},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33338,"y": 557,"z": 31903},
{"data": "","waypointType": 1,"x": 33340,"y": 558,"z": 31901},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33340,"y": 558,"z": 31901},
{"data": "","waypointType": 1,"x": 33343,"y": 559,"z": 31901},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33343,"y": 559,"z": 31901},
{"data": "","waypointType": 1,"x": 33346,"y": 560,"z": 31901},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33346,"y": 560,"z": 31901},
{"data": "","waypointType": 1,"x": 33348,"y": 561,"z": 31903},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33348,"y": 561,"z": 31903},
{"data": "","waypointType": 1,"x": 33350,"y": 562,"z": 31903},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33350,"y": 562,"z": 31903},
{"data": "","waypointType": 1,"x": 33351,"y": 563,"z": 31901},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33351,"y": 563,"z": 31901},
{"data": "","waypointType": 1,"x": 33353,"y": 564,"z": 31901},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33353,"y": 564,"z": 31901},
{"data": "","waypointType": 1,"x": 33355,"y": 565,"z": 31901},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33355,"y": 565,"z": 31901},
{"data": "","waypointType": 1,"x": 33358,"y": 566,"z": 31901},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 566,"z": 31901},
{"data": "","waypointType": 1,"x": 33358,"y": 567,"z": 31902},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 567,"z": 31902},
{"data": "","waypointType": 1,"x": 33359,"y": 568,"z": 31903},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 568,"z": 31903},
{"data": "","waypointType": 1,"x": 33360,"y": 569,"z": 31903},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 569,"z": 31903},
{"data": "","waypointType": 1,"x": 33361,"y": 570,"z": 31904},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 570,"z": 31904},
{"data": "","waypointType": 1,"x": 33361,"y": 571,"z": 31905},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 571,"z": 31905},
{"data": "","waypointType": 1,"x": 33362,"y": 572,"z": 31905},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 572,"z": 31905},
{"data": "","waypointType": 1,"x": 33362,"y": 573,"z": 31907},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 573,"z": 31907},
{"data": "","waypointType": 1,"x": 33362,"y": 574,"z": 31908},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 574,"z": 31908},
{"data": "","waypointType": 1,"x": 33362,"y": 575,"z": 31909},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 575,"z": 31909},
{"data": "","waypointType": 1,"x": 33362,"y": 576,"z": 31910},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 576,"z": 31910},
{"data": "","waypointType": 1,"x": 33362,"y": 577,"z": 31913},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 577,"z": 31913},
{"data": "","waypointType": 1,"x": 33361,"y": 578,"z": 31913},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 578,"z": 31913},
{"data": "","waypointType": 1,"x": 33360,"y": 579,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 579,"z": 31914},
{"data": "","waypointType": 1,"x": 33359,"y": 580,"z": 31913},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 580,"z": 31913},
{"data": "","waypointType": 1,"x": 33359,"y": 581,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 581,"z": 31914},
{"data": "","waypointType": 1,"x": 33358,"y": 582,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 582,"z": 31914},
{"data": "","waypointType": 1,"x": 33356,"y": 583,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33356,"y": 583,"z": 31914},
{"data": "","waypointType": 1,"x": 33355,"y": 584,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33355,"y": 584,"z": 31914},
{"data": "","waypointType": 1,"x": 33354,"y": 585,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33354,"y": 585,"z": 31914},
{"data": "","waypointType": 1,"x": 33354,"y": 586,"z": 31913},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33354,"y": 586,"z": 31913},
{"data": "","waypointType": 1,"x": 33353,"y": 587,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33353,"y": 587,"z": 31914},
{"data": "","waypointType": 1,"x": 33352,"y": 588,"z": 31913},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33352,"y": 588,"z": 31913},
{"data": "","waypointType": 1,"x": 33352,"y": 589,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33352,"y": 589,"z": 31914},
{"data": "","waypointType": 1,"x": 33351,"y": 590,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33351,"y": 590,"z": 31915},
{"data": "","waypointType": 1,"x": 33352,"y": 591,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33352,"y": 591,"z": 31915},
{"data": "","waypointType": 1,"x": 33354,"y": 592,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33354,"y": 592,"z": 31915},
{"data": "","waypointType": 1,"x": 33355,"y": 593,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33355,"y": 593,"z": 31915},
{"data": "","waypointType": 1,"x": 33356,"y": 594,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33356,"y": 594,"z": 31915},
{"data": "","waypointType": 1,"x": 33357,"y": 595,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33357,"y": 595,"z": 31915},
{"data": "","waypointType": 1,"x": 33359,"y": 596,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 596,"z": 31915},
{"data": "","waypointType": 1,"x": 33361,"y": 597,"z": 31915},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 597,"z": 31915},
{"data": "","waypointType": 1,"x": 33361,"y": 598,"z": 31916},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 598,"z": 31916},
{"data": "","waypointType": 1,"x": 33361,"y": 599,"z": 31917},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 599,"z": 31917},
{"data": "","waypointType": 1,"x": 33362,"y": 600,"z": 31917},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 600,"z": 31917},
{"data": "","waypointType": 1,"x": 33362,"y": 601,"z": 31914},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 601,"z": 31914},
{"data": "","waypointType": 1,"x": 33362,"y": 602,"z": 31912},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 602,"z": 31912},
{"data": "","waypointType": 1,"x": 33363,"y": 603,"z": 31911},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33363,"y": 603,"z": 31911},
{"data": "","waypointType": 1,"x": 33363,"y": 604,"z": 31908},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33363,"y": 604,"z": 31908},
{"data": "","waypointType": 1,"x": 33362,"y": 605,"z": 31906},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 605,"z": 31906},
{"data": "","waypointType": 1,"x": 33360,"y": 606,"z": 31904},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 606,"z": 31904},
{"data": "","waypointType": 1,"x": 33359,"y": 607,"z": 31902},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 607,"z": 31902},
{"data": "","waypointType": 1,"x": 33357,"y": 608,"z": 31900},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33357,"y": 608,"z": 31900},
{"data": "","waypointType": 1,"x": 33355,"y": 609,"z": 31900},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33355,"y": 609,"z": 31900},
{"data": "","waypointType": 1,"x": 33352,"y": 610,"z": 31900},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33352,"y": 610,"z": 31900},
{"data": "","waypointType": 1,"x": 33350,"y": 611,"z": 31898},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33350,"y": 611,"z": 31898},
{"data": "","waypointType": 1,"x": 33349,"y": 612,"z": 31897},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33349,"y": 612,"z": 31897},
{"data": "","waypointType": 1,"x": 33349,"y": 613,"z": 31895},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33349,"y": 613,"z": 31895},
{"data": "","waypointType": 1,"x": 33349,"y": 614,"z": 31894},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33349,"y": 614,"z": 31894},
{"data": "","waypointType": 1,"x": 33349,"y": 615,"z": 31893},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33349,"y": 615,"z": 31893},
{"data": "","waypointType": 1,"x": 33349,"y": 616,"z": 31891},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33349,"y": 616,"z": 31891},
{"data": "","waypointType": 1,"x": 33349,"y": 617,"z": 31888},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33349,"y": 617,"z": 31888},
{"data": "","waypointType": 1,"x": 33349,"y": 618,"z": 31885},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33349,"y": 618,"z": 31885},
{"data": "","waypointType": 1,"x": 33352,"y": 619,"z": 31885},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33352,"y": 619,"z": 31885},
{"data": "","waypointType": 1,"x": 33355,"y": 620,"z": 31885},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33355,"y": 620,"z": 31885},
{"data": "","waypointType": 1,"x": 33356,"y": 621,"z": 31884},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33356,"y": 621,"z": 31884},
{"data": "","waypointType": 1,"x": 33357,"y": 622,"z": 31886},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33357,"y": 622,"z": 31886},
{"data": "","waypointType": 1,"x": 33357,"y": 623,"z": 31884},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33357,"y": 623,"z": 31884},
{"data": "","waypointType": 1,"x": 33358,"y": 624,"z": 31884},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 624,"z": 31884},
{"data": "","waypointType": 1,"x": 33358,"y": 625,"z": 31883},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 625,"z": 31883},
{"data": "","waypointType": 1,"x": 33358,"y": 626,"z": 31882},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 626,"z": 31882},
{"data": "","waypointType": 1,"x": 33359,"y": 627,"z": 31882},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 627,"z": 31882},
{"data": "","waypointType": 1,"x": 33359,"y": 628,"z": 31881},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 628,"z": 31881},
{"data": "","waypointType": 1,"x": 33357,"y": 629,"z": 31881},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33357,"y": 629,"z": 31881},
{"data": "","waypointType": 1,"x": 33358,"y": 630,"z": 31880},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 630,"z": 31880},
{"data": "","waypointType": 1,"x": 33359,"y": 631,"z": 31880},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 631,"z": 31880},
{"data": "","waypointType": 1,"x": 33360,"y": 632,"z": 31880},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 632,"z": 31880},
{"data": "","waypointType": 1,"x": 33361,"y": 633,"z": 31880},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 633,"z": 31880},
{"data": "","waypointType": 1,"x": 33361,"y": 634,"z": 31879},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 634,"z": 31879},
{"data": "","waypointType": 1,"x": 33360,"y": 635,"z": 31879},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 635,"z": 31879},
{"data": "","waypointType": 1,"x": 33359,"y": 636,"z": 31879},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 636,"z": 31879},
{"data": "","waypointType": 1,"x": 33358,"y": 637,"z": 31878},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 637,"z": 31878},
{"data": "","waypointType": 1,"x": 33359,"y": 638,"z": 31878},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 638,"z": 31878},
{"data": "","waypointType": 1,"x": 33360,"y": 639,"z": 31878},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 639,"z": 31878},
{"data": "","waypointType": 1,"x": 33359,"y": 640,"z": 31877},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 640,"z": 31877},
{"data": "","waypointType": 1,"x": 33359,"y": 641,"z": 31876},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 641,"z": 31876},
{"data": "","waypointType": 1,"x": 33358,"y": 642,"z": 31875},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 642,"z": 31875},
{"data": "","waypointType": 1,"x": 33359,"y": 643,"z": 31874},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 643,"z": 31874},
{"data": "","waypointType": 1,"x": 33361,"y": 644,"z": 31874},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 644,"z": 31874},
{"data": "","waypointType": 1,"x": 33362,"y": 645,"z": 31874},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 645,"z": 31874},
{"data": "","waypointType": 1,"x": 33362,"y": 646,"z": 31873},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33362,"y": 646,"z": 31873},
{"data": "","waypointType": 1,"x": 33361,"y": 647,"z": 31873},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 647,"z": 31873},
{"data": "","waypointType": 1,"x": 33360,"y": 648,"z": 31873},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 648,"z": 31873},
{"data": "","waypointType": 1,"x": 33359,"y": 649,"z": 31873},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 649,"z": 31873},
{"data": "","waypointType": 1,"x": 33360,"y": 650,"z": 31872},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 650,"z": 31872},
{"data": "","waypointType": 1,"x": 33359,"y": 651,"z": 31872},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 651,"z": 31872},
{"data": "","waypointType": 1,"x": 33358,"y": 652,"z": 31871},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 652,"z": 31871},
{"data": "","waypointType": 1,"x": 33358,"y": 653,"z": 31870},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 653,"z": 31870},
{"data": "","waypointType": 1,"x": 33359,"y": 654,"z": 31870},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 654,"z": 31870},
{"data": "","waypointType": 1,"x": 33359,"y": 655,"z": 31869},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 655,"z": 31869},
{"data": "","waypointType": 1,"x": 33358,"y": 656,"z": 31869},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 656,"z": 31869},
{"data": "","waypointType": 1,"x": 33358,"y": 657,"z": 31868},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 657,"z": 31868},
{"data": "","waypointType": 1,"x": 33359,"y": 658,"z": 31868},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 658,"z": 31868},
{"data": "","waypointType": 1,"x": 33359,"y": 659,"z": 31867},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 659,"z": 31867},
{"data": "","waypointType": 1,"x": 33360,"y": 660,"z": 31867},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 660,"z": 31867},
{"data": "","waypointType": 1,"x": 33361,"y": 661,"z": 31866},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 661,"z": 31866},
{"data": "","waypointType": 1,"x": 33361,"y": 662,"z": 31865},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33361,"y": 662,"z": 31865},
{"data": "","waypointType": 1,"x": 33360,"y": 663,"z": 31864},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 663,"z": 31864},
{"data": "","waypointType": 1,"x": 33360,"y": 664,"z": 31865},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 664,"z": 31865},
{"data": "","waypointType": 1,"x": 33360,"y": 665,"z": 31866},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33360,"y": 665,"z": 31866},
{"data": "","waypointType": 1,"x": 33359,"y": 666,"z": 31866},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 666,"z": 31866},
{"data": "","waypointType": 1,"x": 33359,"y": 667,"z": 31864},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33359,"y": 667,"z": 31864},
{"data": "","waypointType": 1,"x": 33358,"y": 668,"z": 31863},{            "data": "-- ================================================================\n-- MadMage Simple - Script Reduzido de Limpeza\n-- ================================================================\n-- Script simplificado para limpar dirt nos SQMs adjacentes e central\n-- Funcionalidades:\n-- 1. Busca item nos containers\n-- 2. Escaneia 9 SQMs (central + 8 adjacentes)\n-- 3. Usa item em cada SQM com dirt\n-- 4. Valida se estão limpos\n-- 5. Finaliza quando todos estiverem limpos\n\n-- ================================================================\n-- CONFIGURAÇÕES\n-- ================================================================\n\n-- Lista de itens buscados (dirt items)\nlocal ItensBuscados = {\n    12075, 12351, 12349, \n    12347, 12354, 12083, \n    12076, 12353, 12063, \n    12062, 12059, 12061, \n    12060\n}\n\n-- ID do item de limpeza (broom)\nlocal ITEM_LIMPEZA = 12077\n\n-- Delays\nlocal QUICK_CHECK_DELAY = 200  -- 200ms após usar item\nlocal RETRY_DELAY = 1200       -- 1200ms entre tentativas\nlocal MAX_ATTEMPTS = 3         -- Máximo 3 tentativas por SQM\n\n-- Contador global de tentativas para evitar loop infinito\nlocal globalAttempts = 0\nlocal MAX_GLOBAL_ATTEMPTS = 10  -- Máximo 10 ciclos completos de limpeza\n\n-- Lista de timers ativos para poder destruí-los todos\nlocal activeTimers = {}\n\n\n-- ================================================================\n-- FUNÇÕES AUXILIARES\n-- ================================================================\n\n-- Tabela hash para busca rápida\nlocal ItensBuscadosHash = {}\nfor _, itemId in ipairs(ItensBuscados) do\n    ItensBuscadosHash[itemId] = true\nend\n\n-- Função para obter posição atual do player\nlocal function getPlayerPosition()\n    local playerId = Player.getId()\n    if not playerId then\n        return nil\n    end\n    \n    local player = Creature.new(playerId)\n    if not player then\n        return nil\n    end\n    \n    return player:getPosition()\nend\n\n-- Função para verificar se um item está na lista de itens buscados\nlocal function isItemSought(itemId)\n    return ItensBuscadosHash[itemId] == true\nend\n\n-- Função para verificar se um SQM tem dirt\nlocal function hasDirtInTile(x, y, z)\n    local things = Map.getThings(x, y, z)\n    if not things then\n        return false\n    end\n    \n    for _, thing in ipairs(things) do\n        if isItemSought(thing.id) then\n            return true\n        end\n    end\n    \n    return false\nend\n\n-- Função recursiva para buscar item em containers abertos\nlocal function searchItemInContainers(itemId, visitedContainers)\n    visitedContainers = visitedContainers or {}\n    local containers = Player.getContainers()\n    \n    if not containers or #containers == 0 then\n        return false\n    end\n    \n    for _, containerIndex in ipairs(containers) do\n        if not visitedContainers[containerIndex] then\n            visitedContainers[containerIndex] = true\n            \n            local container = Container.new(containerIndex)\n            if container then\n                local items = container:getItems()\n                \n                if items then\n                    for _, item in ipairs(items) do\n                        if item.id == itemId then\n                            print(string.format(\"? Item %d encontrado em container\", itemId))\n                            return true\n                        end\n                    end\n                end\n            end\n        end\n    end\n    \n    return false\nend\n\n-- Função para verificar se o item de limpeza está disponível em containers\nlocal function hasCleaningItem()\n    -- Buscar apenas em containers (não verifica inventário)\n    if searchItemInContainers(ITEM_LIMPEZA) then\n        return true\n    end\n    \n    return false\nend\n\n-- Função para escanear os 9 SQMs (central + 8 adjacentes)\nlocal function scanAdjacentSQMs()\n    local playerPos = getPlayerPosition()\n    if not playerPos then\n        return {}\n    end\n    \n    local sqmsWithDirt = {}\n    local sqmsChecked = {}\n    \n    -- Verificar SQM central e todos os adjacentes (3x3 grid)\n    for dx = -1, 1 do\n        for dy = -1, 1 do\n            local check_x = playerPos.x + dx\n            local check_y = playerPos.y + dy\n            local check_z = playerPos.z\n            local sqmKey = string.format(\"%d,%d,%d\", check_x, check_y, check_z)\n            \n            -- Evitar verificar o mesmo SQM duas vezes\n            if not sqmsChecked[sqmKey] then\n                sqmsChecked[sqmKey] = true\n                \n                if hasDirtInTile(check_x, check_y, check_z) then\n                    table.insert(sqmsWithDirt, {\n                        x = check_x,\n                        y = check_y,\n                        z = check_z\n                    })\n                    print(string.format(\"?? Dirt encontrado em SQM (%d,%d,%d)\", check_x, check_y, check_z))\n                end\n            end\n        end\n    end\n    \n    return sqmsWithDirt\nend\n\n-- Função para limpar um SQM específico com retry\nlocal function cleanSQM(sqm, callback)\n    if not sqm then\n        if callback then callback(false) end\n        return\n    end\n    \n    local attempts = 0\n    \n    local function tryClean()\n        attempts = attempts + 1\n        \n        print(string.format(\"?? Tentativa %d/%d: Limpando SQM (%d,%d,%d)\", \n            attempts, MAX_ATTEMPTS, sqm.x, sqm.y, sqm.z))\n        \n        -- Usar item no tile\n        local result = Game.useItemOnGround(ITEM_LIMPEZA, sqm.x, sqm.y, sqm.z)\n        \n        if not result then\n            print(string.format(\"? Falha ao usar item no SQM (%d,%d,%d)\", sqm.x, sqm.y, sqm.z))\n        end\n        \n        -- Aguardar 200ms e verificar se sujeira sumiu\n        local quickCheckTimerName = \"MadMageSimple_QuickCheck_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n        activeTimers[quickCheckTimerName] = true\n        Timer.new(quickCheckTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar (timers são repetitivos por padrão)\n            destroyTimer(quickCheckTimerName)\n            activeTimers[quickCheckTimerName] = nil  -- Remover da lista quando executar\n            \n            if not hasDirtInTile(sqm.x, sqm.y, sqm.z) then\n                -- Sujeira sumiu! Sucesso\n                print(string.format(\"? SQM (%d,%d,%d) limpo com sucesso\", sqm.x, sqm.y, sqm.z))\n                if callback then callback(true) end\n            else\n                -- Sujeira ainda persiste\n                if attempts >= MAX_ATTEMPTS then\n                    -- Excedeu tentativas\n                    print(string.format(\"? SQM (%d,%d,%d) ainda tem dirt após %d tentativas\", \n                        sqm.x, sqm.y, sqm.z, MAX_ATTEMPTS))\n                    if callback then callback(false) end\n                else\n                    -- Aguardar 1200ms antes de tentar novamente\n                    local retryTimerName = \"MadMageSimple_Retry_\" .. sqm.x .. \"_\" .. sqm.y .. \"_\" .. sqm.z\n                    activeTimers[retryTimerName] = true\n                    Timer.new(retryTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryTimerName)\n                        activeTimers[retryTimerName] = nil  -- Remover da lista quando executar\n                        tryClean()\n                    end, RETRY_DELAY, true)\n                end\n            end\n        end, QUICK_CHECK_DELAY, true)\n    end\n    \n    -- Iniciar primeira tentativa\n    tryClean()\nend\n\n-- Função para limpar múltiplos SQMs sequencialmente\nlocal function cleanAllSQMs(sqms, callback)\n    if not sqms or #sqms == 0 then\n        if callback then callback(true) end\n        return\n    end\n    \n    local currentIndex = 1\n    \n    local function cleanNext()\n        if currentIndex <= #sqms then\n            local sqm = sqms[currentIndex]\n            \n            -- Limpar este tile\n            cleanSQM(sqm, function(success)\n                -- Após limpar este tile, passar para o próximo\n                currentIndex = currentIndex + 1\n                cleanNext()\n            end)\n        else\n            -- Processou todos os SQMs, chamar callback\n            if callback then callback(true) end\n        end\n    end\n    \n    -- Iniciar processamento do primeiro tile\n    cleanNext()\nend\n\n-- Função para validar se todos os SQMs estão limpos\nlocal function validateAllClean()\n    local remainingDirt = scanAdjacentSQMs()\n    \n    if #remainingDirt == 0 then\n        print(\"? Todos os SQMs estão limpos!\")\n        return true\n    else\n        print(string.format(\"? Ainda há %d SQMs com dirt\", #remainingDirt))\n        return false\n    end\nend\n\n-- Função para destruir todos os timers ativos\nlocal function destroyTimers()\n    -- Destruir todos os timers que estão na lista de ativos\n    for timerName, _ in pairs(activeTimers) do\n        destroyTimer(timerName)\n    end\n    -- Limpar a lista de timers ativos\n    activeTimers = {}\n    \n    -- Também tentar destruir timers com nomes fixos (caso algum não tenha sido rastreado)\n    destroyTimer(\"MadMageSimple_Validate\")\n    destroyTimer(\"MadMageSimple_RetryGlobal\")\nend\n\nlocal function toggleCaveBot(toPause)\n    if toPause then\n        CaveBot.pause(99999)\n    else\n        destroyTimers()\n        CaveBot.pause(0)\n    end\nend\n\n-- ================================================================\n-- FUNÇÃO PRINCIPAL\n-- ================================================================\n\nlocal function startCleaning()\n    print(\"========================================\")\n    print(\"MadMage Simple - Iniciando Limpeza\")\n    print(\"========================================\")\n    \n    -- Pausar CaveBot antes de iniciar\n    toggleCaveBot(true)\n    \n    -- 1. Buscar item nos containers\n    if not hasCleaningItem() then\n        print(string.format(\"? ERRO: Item %d não encontrado em containers!\", ITEM_LIMPEZA))\n        print(\"Verifique se tem o item de limpeza disponível.\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    -- 2. Escanear SQMs adjacentes e central\n    print(\"\\n?? Escaneando SQMs (central + 8 adjacentes)...\")\n    local sqmsWithDirt = scanAdjacentSQMs()\n    \n    if #sqmsWithDirt == 0 then\n        print(\"? Nenhum dirt encontrado. Todos os SQMs já estão limpos!\")\n        -- IMPORTANTE: Despausar CaveBot antes de retornar\n        toggleCaveBot(false)\n        return\n    end\n    \n    print(string.format(\"\\n?? Encontrados %d SQMs com dirt\", #sqmsWithDirt))\n    \n    -- 3. Limpar todos os SQMs\n    print(\"\\n?? Iniciando limpeza...\")\n    \n    cleanAllSQMs(sqmsWithDirt, function()\n        -- 4. Validar se estão limpos\n        print(\"\\n?? Validando limpeza...\")\n        local validateTimerName = \"MadMageSimple_Validate\"\n        activeTimers[validateTimerName] = true\n        Timer.new(validateTimerName, function()\n            -- IMPORTANTE: Destruir o timer após executar\n            destroyTimer(validateTimerName)\n            activeTimers[validateTimerName] = nil  -- Remover da lista quando executar\n            \n            if validateAllClean() then\n                -- 5. Finalizar script\n                print(\"\\n========================================\")\n                print(\"? Limpeza concluída com sucesso!\")\n                print(\"========================================\")\n                globalAttempts = 0  -- Resetar contador ao concluir\n                toggleCaveBot(false)\n            else\n                -- Ainda há dirt, verificar limite de tentativas globais\n                globalAttempts = globalAttempts + 1\n                \n                if globalAttempts >= MAX_GLOBAL_ATTEMPTS then\n                    print(string.format(\"\\n? Limite de %d tentativas globais atingido. Despausando CaveBot...\", MAX_GLOBAL_ATTEMPTS))\n                    print(\"Alguns SQMs ainda podem ter dirt. Execute o script novamente se necessário.\")\n                    globalAttempts = 0\n                    toggleCaveBot(false)\n                else\n                    print(string.format(\"\\n?? Tentativa global %d/%d: Reiniciando limpeza...\", globalAttempts, MAX_GLOBAL_ATTEMPTS))\n                    -- Aguardar um pouco antes de tentar novamente (evita loop muito rápido)\n                    local retryGlobalTimerName = \"MadMageSimple_RetryGlobal\"\n                    activeTimers[retryGlobalTimerName] = true\n                    Timer.new(retryGlobalTimerName, function()\n                        -- IMPORTANTE: Destruir o timer após executar\n                        destroyTimer(retryGlobalTimerName)\n                        activeTimers[retryGlobalTimerName] = nil  -- Remover da lista quando executar\n                        startCleaning()\n                    end, 1000, true)\n                end\n            end\n        end, 500, true)\n    end)\nend\n\n-- ================================================================\n-- INICIALIZAÇÃO\n-- ================================================================\n\n-- Iniciar limpeza automaticamente\nstartCleaning()\n",            "waypointType": 11,"x": 33358,"y": 668,"z": 31863},

    ]
}
